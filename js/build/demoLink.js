!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.demoLink=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>c});var e=i("ckeditor5/src/core.js");function t(e,t){const i=e.getSelectedElement();return i&&i.name==t?i:e.getFirstRange().getCommonAncestor().findAncestor(t)}class o extends e.Command{refresh(){this.isEnabled=!0,this.value=null;const{selection:e}=this.editor.model.document,i=t(e,"demoLink");if(i){this.value={};for(const[e,t]of i.getAttributes())this.value[e]=t;for(const e of i.getChildren()){const t=e.getChild(0),i=t&&t._data;this.value[e.name]=i?t._data:""}}}execute(e){const{model:i}=this.editor;i.change((n=>{var o=!1,s=t(i.document.selection,"demoLink");s||(s=n.createElement("demoLink"),o=!0),this._editElement(n,s,e),o&&i.insertContent(s)}))}_editElement(e,t,i){e.clearAttributes(t);var n={};n.demoLinkUrl=i.demoLinkUrl,n.demoLinkClass="demo-link",e.setAttributes(n,t);const o=[];Array.from(t.getChildren()).forEach((e=>{o.push(e.name)}));const s=this._processChildTextEl(e,i,o,t,"demoLinkText"),l=this._processChildTextEl(e,i,o,t,"demoLinkFileExtension");s&&e.append(s,t),l&&e.append(l,t)}_processChildTextEl(e,t,i,n,o){const s=this._processChildElement(e,t[o],i,n,o);if(s){const i=s.getChild(0);return i&&e.remove(i),e.appendText(t[o],s),s}return null}_processChildElement(e,t,i,n,o){const s=t&&!i.includes(o),l=t&&i.includes(o),r=!t&&i.includes(o);var d=null;if(s)d=e.createElement(o);else if(l||r){let e=[];Array.from(n.getChildren()).forEach((t=>{e.push(t.name)}));var a=e.indexOf(o);d=n.getChild(a)}return i.includes(o)&&d&&e.remove(d),r?null:d}}class s extends e.Plugin{init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("demoLink",new o(this.editor))}_defineSchema(){const e=this.editor.model.schema;e.register("demoLink",{inheritAllFrom:"$inlineObject",allowAttributes:["demoLinkUrl","demoLinkClass"],allowChildren:["demoLinkText","demoLinkFileExtension"]}),e.register("demoLinkText",{allowIn:"demoLink",isLimit:!0,allowContentOf:"$block"}),e.register("demoLinkFileExtension",{allowIn:"demoLink",isLimit:!0,allowContentOf:"$block"})}_defineConverters(){const{conversion:e}=this.editor;e.for("upcast").elementToElement({view:{name:"a"},model:(e,{writer:t})=>{const i=e.getAttribute("class");if(!i)return null;if(!i.split(" ").includes("demo-link"))return null;var n={demoLinkUrl:e.getAttribute("href")};return t.createElement("demoLink",n)}}),e.for("downcast").elementToElement({model:"demoLink",view:(e,{writer:t})=>{var i={class:"demo-link",href:e.getAttribute("demoLinkUrl")};return t.createContainerElement("a",i)}}),e.for("upcast").attributeToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"demoLinkUrl",value:e=>e.getAttribute("href")}}),e.for("upcast").attributeToAttribute({view:{name:"a",attributes:{class:!0}},model:{key:"demoLinkClass",value:e=>e.getAttribute("class")}}),e.for("upcast").elementToElement({view:{name:"span",classes:"text"},model:(e,{writer:t})=>t.createElement("demoLinkText")}),e.for("downcast").elementToElement({model:"demoLinkText",view:(e,{writer:t})=>t.createContainerElement("span",{class:"text"})}),e.for("upcast").elementToElement({view:{name:"small",classes:"file-extension"},model:(e,{writer:t})=>t.createElement("demoLinkFileExtension")}),e.for("downcast").elementToElement({model:"demoLinkFileExtension",view:(e,{writer:t})=>t.createContainerElement("small",{class:"file-extension"})})}}var l=i("ckeditor5/src/ui.js");class r extends l.View{constructor(t){super(t),this.textInputView=this._createInput("Text",{required:!0}),this.fileExtensionInputView=this._createInput("File extension"),this.urlInputView=this._createInput("URL",{required:!0}),this.saveButtonView=this._createButton("Save",e.icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton("Cancel",e.icons.cancel,"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.childViewsCollection=this.createCollection([this.textInputView,this.fileExtensionInputView,this.urlInputView,this.saveButtonView,this.cancelButtonView]),this.setTemplate({tag:"form",attributes:{class:["ck","ck-demo-link-form"],tabindex:"-1"},children:this.childViewsCollection})}render(){super.render(),(0,l.submitHandler)({view:this})}focus(){this.childViewsCollection.first.focus()}_createInput(e,t={}){const i=new l.LabeledFieldView(this.locale,l.createLabeledInputText);return i.label=e,t.required&&!0===t.required&&i.fieldView.extendTemplate({attributes:{required:!0}}),i}_createButton(e,t,i){const n=new l.ButtonView;return n.set({label:e,icon:t,tooltip:!0,class:i}),n}}class d extends e.Plugin{static get requires(){return[l.ContextualBalloon]}init(){this._balloon=this.editor.plugins.get(l.ContextualBalloon),this._addToolbarButton(),this.formView=this._createFormView(),this._handleSelection()}_addToolbarButton(){const e=this.editor;e.ui.componentFactory.add("demoLink",(t=>{const i=new l.ButtonView(t);i.set({label:e.t("demoLink"),icon:'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="55.000000pt" height="54.000000pt" viewBox="0 0 55.000000 54.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,54.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M201 514 c-28 -35 -26 -69 4 -99 51 -51 135 -18 135 53 0 45 -30 72\n-79 72 -31 0 -44 -6 -60 -26z"/>\n<path d="M415 379 c-51 -29 -59 -76 -20 -114 30 -30 64 -32 99 -4 64 50 -8\n157 -79 118z"/>\n<path d="M233 210 c-79 -32 -57 -150 28 -150 82 0 110 108 38 145 -32 17 -35\n17 -66 5z"/>\n<path d="M420 213 c-56 -21 -70 -96 -24 -132 50 -40 114 -18 130 44 8 31 -17\n72 -52 85 -28 11 -32 11 -54 3z"/>\n<path d="M25 185 c-40 -39 -31 -89 18 -110 79 -33 144 56 84 113 -31 29 -72\n28 -102 -3z"/>\n</g>\n</svg>\n',tooltip:!0});const n=e.commands.get("demoLink");return i.bind("isEnabled").to(n,"isEnabled"),i.bind("isOn").to(n,"value",(e=>!!e)),this.listenTo(i,"execute",(()=>this._showUI())),i}))}_createFormView(){const e=new r(this.editor.locale);return this.listenTo(e,"submit",(()=>{let t={demoLinkText:e.textInputView.fieldView.element.value,demoLinkFileExtension:e.fileExtensionInputView.fieldView.element.value,demoLinkUrl:e.urlInputView.fieldView.element.value};this.editor.execute("demoLink",t),this._hideUI()})),this.listenTo(e,"cancel",(()=>{this._hideUI()})),(0,l.clickOutsideHandler)({emitter:e,activator:()=>this._balloon.visibleView===e,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),e}_addFormView(){this._balloon.add({view:this.formView,position:this._getBalloonPositionData()});const e=this.editor.commands.get("demoLink");Object.entries({demoLinkText:"textInputView",demoLinkFileExtension:"fileExtensionInputView",demoLinkUrl:"urlInputView"}).forEach((([t,i])=>{const n=this.formView[i];n.focus();const o=!e.value||!e.value[t]||""===e.value[t];if("demoLinkUrl"===t&&o)return n.fieldView.element.value="#",void n.set("isEmpty",!1);o||(n.fieldView.element.value=e.value[t]),n.set("isEmpty",o)})),this.formView.focus()}_handleSelection(){const e=this.editor;this.listenTo(e.editing.view.document,"selectionChange",((i,n)=>{const o=e.model.document.selection;let s=o.getSelectedElement()??o.getFirstRange().getCommonAncestor();if(!["demoLinkText","demoLinkFileExtension"].includes(s.name))return void this._hideUI();this._showUI();const l=e.model.createPositionBefore(s),r=e.model.createPositionAfter(s),d=o.getFirstPosition(),a=t(o,"demoLink");var c=!1;for(const e of a.getChildren())"demoLinkFileExtension"!==e.name||(c=!0);const m=c?"demoLinkFileExtension":"demoLinkText",u="demoLinkText"==s.name&&d.isTouching(l),h=s.name==m&&d.isTouching(r);(u||h)&&e.model.change((e=>{e.setSelection(s.findAncestor("demoLink"),"on")}))}))}_showUI(){this._addFormView()}_hideUI(){const e=this.formView;e.element&&e.element.reset(),this._balloon.hasView(e)&&this._balloon.remove(e),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;let i=null;return i=()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange()),{target:i}}}class a extends e.Plugin{static get requires(){return[s,d]}static get pluginName(){return"demoLink"}}const c={DemoLink:a}})(),n=n.default})()));
